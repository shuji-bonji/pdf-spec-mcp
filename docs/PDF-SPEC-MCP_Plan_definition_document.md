# PDF SPEC MCP — 企画定義書

> ISO 32000 (PDF) 仕様をAIエージェントからアクセス可能にするMCPサーバー

## 1. プロジェクト概要

### What（何を作るか）

ISO 32000（PDF仕様書）の構造的な参照・検索・要件抽出を、Model Context Protocol（MCP）を通じてAIエージェントに提供するサーバー。

### Why（なぜ作るか）

- PDF仕様を参照するMCPサーバーは世界に**存在しない**（既存のPDF系MCPはすべてPDFファイルの操作ツール）
- Adobe AIによる対話的な仕様参照は可能だが、**AIエージェントのワークフローに仕様知識を組み込む手段**がない
- PDF開発者が仕様書（約1,000ページ）から必要な情報を探す作業は非常に非効率

### What This Is NOT

- PDFファイルの読み取り・操作ツールではない
- Adobe Acrobat AI の代替ではない
- PDF仕様書の全文翻訳ツールではない

## 2. ターゲットユーザー

### Primary: PDF開発者

PDFライブラリ（pdf.js, PyPDF, iText, Apache PDFBox 等）を開発・拡張・メンテナンスしている開発者。

- 実装時に仕様の正確な記述を参照したい
- バグ修正時に「仕様上正しい挙動」を確認したい
- バージョン間（PDF 1.7 ↔ PDF 2.0）の差分を知りたい

### Secondary: 電子署名・セキュリティ実装者

PAdES（PDF電子署名）や暗号化機能を実装する開発者。

- 署名・タイムスタンプの仕様要件を正確に把握したい
- ハッシュアルゴリズム拡張（TS 32001）、署名拡張（TS 32002）を参照したい
- PDF/A（長期保存）やPDF/UA（アクセシビリティ）の準拠要件を確認したい

### Tertiary: AIエージェント開発者

Claude Code 等のAIエージェントを使ってPDF処理コードを生成・検証する開発者。

- AIがPDFパーサーを実装する際の仕様参照エンジンとして
- テストケース生成の根拠として仕様を引用
- 自動コードレビューで仕様準拠を検証

## 3. ユースケースとシナリオ

### UC-1: セクション参照（最も基本的な操作）

```
ユーザー: 「PDFのフォント埋め込みの仕様を教えて」
Agent → pdf-spec-mcp: get_section("9.6")
Agent ← 仕様のセクション内容（構造化されたテキスト）
Agent → ユーザーへ回答
```

**シナリオ**: pdf.js でフォント描画のバグを修正中。仕様上の正しい動作を確認したい。

### UC-2: 要件抽出（SHALL/MUST の一覧）

```
ユーザー: 「暗号化に関する必須要件を一覧で出して」
Agent → pdf-spec-mcp: get_requirements({ section: "7.6", level: "SHALL" })
Agent ← 要件のリスト（要件レベル + セクション参照付き）
```

**シナリオ**: 自社PDFライブラリがISO 32000-2に準拠しているか監査したい。

### UC-3: 電子署名仕様の参照

```
ユーザー: 「PAdESの署名検証フローの仕様は？」
Agent → pdf-spec-mcp: get_section("12.8") // 本体の署名セクション
Agent → pdf-spec-mcp: get_ts_section("32002", "5") // TS 32002 の拡張
Agent ← 両方の仕様内容を統合して回答
```

**シナリオ**: 電子署名SPAの実装で、タイムスタンプ検証のロジックが仕様通りか確認したい。

### UC-4: バージョン間差分の確認

```
ユーザー: 「XFAはPDF 2.0で廃止された？代替は？」
Agent → pdf-spec-mcp: compare_versions({ feature: "XFA" })
Agent ← PDF 1.7 での記述 + PDF 2.0 での廃止情報 + 代替手段
```

**シナリオ**: 旧PDFフォーム対応のマイグレーション計画を立てたい。

### UC-5: AIエージェントによるコード生成支援

```
Agent（Claude Code等）: PDFパーサーのクロスリファレンステーブル読み取りを実装中
Agent → pdf-spec-mcp: get_section("7.5.8") // クロスリファレンステーブル
Agent ← 仕様のデータ構造定義
Agent → 仕様に基づいた正確なパーサーコードを生成
```

**シナリオ**: AIが仕様を「正しい情報源」として参照しながらコードを書く。

### UC-6: PDF/A・PDF/UA 準拠チェック支援

```
ユーザー: 「PDF/A-4 で禁止されている機能は？」
Agent → pdf-spec-mcp: get_requirements({ profile: "PDF/A-4", level: "SHALL NOT" })
Agent ← 禁止事項のリスト
```

**シナリオ**: 官公庁向けの文書管理システムで、PDF/A準拠のバリデーションルールを実装したい。

### UC-7: 翻訳ワークフローとの連携

```
Agent → pdf-spec-mcp: get_section("12.8.1") // 英語の仕様テキスト
Agent → deepl-mcp: translate(text, "ja") // 日本語に翻訳
Agent → xcomet-mcp: evaluate(source, translation) // 翻訳品質を評価
Agent → ユーザーへ高品質な日本語仕様参照を提供
```

**シナリオ**: 日本語話者のPDF開発者が、仕様を母国語で正確に理解したい。

### UC-8: 証憑管理（e-shiwake連携）

```
Agent → pdf-spec-mcp: get_section("12.8") // 電子署名の仕様
Agent → pdf-spec-mcp: get_ts_section("32002", "...") // PAdES拡張
Agent → e-shiwake の証憑検証ロジックの仕様適合を確認
```

**シナリオ**: 電子帳簿保存法対応で、証憑PDFのタイムスタンプ・署名検証が仕様に準拠しているか確認。

## 4. 対象仕様書

### コア仕様

| ファイル                         | 仕様                   | 優先度 | 役割                     |
| -------------------------------- | ---------------------- | ------ | ------------------------ |
| `ISO_32000-2-2020_sponsored.pdf` | PDF 2.0（最新版）      | ★★★    | メイン仕様               |
| `PDF32000_2008.pdf`              | PDF 1.7（ISO 32000-1） | ★★★    | 現行主流版。差分比較用   |
| `pdfreference1.7old.pdf`         | PDF 1.7（Adobe版）     | ★☆☆    | 旧版リファレンス（補助） |

### 拡張仕様（TS: Technical Specification）

| ファイル                          | 仕様                     | 優先度 | 役割                     |
| --------------------------------- | ------------------------ | ------ | ------------------------ |
| `ISO_TS_32001-2022_sponsored.pdf` | ハッシュアルゴリズム拡張 | ★★☆    | SHA-3 等の新ハッシュ対応 |
| `ISO_TS_32002-2022_sponsored.pdf` | 電子署名拡張（PAdES）    | ★★★    | 電子署名の詳細仕様       |
| `ISO_TS_32003-2023_sponsored.pdf` | AES-GCM 暗号化           | ★★☆    | 次世代暗号化             |

## 5. 提供機能（ツール設計案）

### 5.1 構造参照系

| ツール名        | 説明                                      |
| --------------- | ----------------------------------------- |
| `get_structure` | PDF仕様書のセクション階層・目次構造を取得 |
| `get_section`   | 指定セクション番号の仕様内容を取得        |
| `search_spec`   | キーワードで仕様内容を全文検索            |

### 5.2 要件抽出系

| ツール名           | 説明                                                 |
| ------------------ | ---------------------------------------------------- |
| `get_requirements` | SHALL/MUST/MAY 等の規範的要件を抽出                  |
| `get_definitions`  | 用語定義を取得                                       |
| `get_tables`       | 仕様内のテーブル（オブジェクト定義等）を構造的に取得 |

### 5.3 横断参照系

| ツール名           | 説明                                             |
| ------------------ | ------------------------------------------------ |
| `compare_versions` | PDF 1.7 と PDF 2.0 の特定機能の差分を取得        |
| `get_ts_section`   | 拡張仕様（TS 32001/32002/32003）のセクション参照 |

### ツール数の方針

rfcxml-mcp と同様、**7〜10ツール以内**に絞る。単一責任の原則を維持し、LLMのコンテキストを圧迫しない設計とする。

## 6. 技術設計の方針

### データソース

```
ユーザーがPDF Associationから仕様書をダウンロード
  ↓
ローカルディレクトリに配置
  ↓
環境変数 PDF_SPEC_DIR で指定
  ↓
MCP サーバー起動時に構造解析・インデックス化
```

### 設定例

```json
{
	"mcpServers": {
		"pdf-spec": {
			"command": "npx",
			"args": ["@shuji-bonji/pdf-spec-mcp"],
			"env": {
				"PDF_SPEC_DIR": "/path/to/pdf-specs"
			}
		}
	}
}
```

### 技術スタック

| 項目       | 選定                               | 理由                         |
| ---------- | ---------------------------------- | ---------------------------- |
| 言語       | TypeScript                         | rfcxml-mcp との一貫性        |
| 配布       | npm (`@shuji-bonji/pdf-spec-mcp`)  | 既存のパッケージ体系に統合   |
| PDF解析    | 要調査（pdf-parse, pdfjs-dist 等） | Tagged PDF構造の取得品質次第 |
| キャッシュ | LRU Cache                          | rfcxml-mcp と同じパターン    |
| テスト     | Vitest                             | rfcxml-mcp と同じ            |

### 最初の技術検証ポイント

ISO_32000-2-2020_sponsored.pdf の**Tagged PDF構造**がどこまで機械的に抽出可能か。これが全体の設計を決定する。

- セクション階層がタグから取れるか
- テーブル構造が保持されているか
- 用語定義・要件文が識別可能か

## 7. 他MCPとの連携

```
┌─────────────────────────────────────────────────────┐
│              AI Agent（Claude等）                      │
├──────────┬──────────┬──────────┬─────────────────────┤
│ pdf-spec │ rfcxml   │ w3c-mcp  │ epsg-mcp            │
│ -mcp     │ -mcp     │          │                     │
│ PDF仕様  │ RFC仕様  │ Web標準  │ 座標参照系           │
├──────────┴──────────┴──────────┴─────────────────────┤
│              技術仕様リファレンス層                     │
├──────────┬──────────┬────────────────────────────────┤
│ deepl    │ xcomet   │ その他ツール系MCP               │
│ -mcp     │ -mcp     │                                │
│ 翻訳     │ 品質評価  │                                │
├──────────┴──────────┴────────────────────────────────┤
│              翻訳・品質保証層                          │
└──────────────────────────────────────────────────────┘
```

### 連携シナリオ

- **pdf-spec-mcp + deepl-mcp + xcomet-mcp**: 仕様参照 → 翻訳 → 品質評価
- **pdf-spec-mcp + rfcxml-mcp**: PDF電子署名 ↔ RFC 5652 (CMS) 等のプロトコル仕様の横断参照
- **pdf-spec-mcp + e-shiwake**: 証憑管理の仕様適合検証

## 8. 競合・差別化

| 比較対象         | アプローチ                              | pdf-spec-mcp との違い            |
| ---------------- | --------------------------------------- | -------------------------------- |
| Adobe Acrobat AI | 人間がPDFを開いて対話的に質問           | AIエージェントから呼べない       |
| ChatGPT + PDF    | PDFアップロードして質問                 | セッション限定。構造的な参照不可 |
| Web検索          | 断片的な情報                            | 正確性・網羅性に欠ける           |
| **pdf-spec-mcp** | **MCPで仕様をプログラマティックに提供** | **AIの推論と行動の基盤になる**   |

### 核心的な差別化

> Adobe AIは「人間に情報を提供する」ツール。
> pdf-spec-mcp は「AIエージェントの知識インフラに仕様を組み込む」パイプライン。

エージェントが自律的に動く時代になるほど、この差は開いていく。

## 9. ライセンスに関する留意事項

- ISO 32000-2:2020 は PDF Association により**無料公開**されている（2023年4月〜）
- スポンサー: Adobe, Apryse, Foxit
- 仕様書のPDFファイル自体をリポジトリに含めることは避け、**ユーザーが自身でダウンロード・配置する方式**とする
- READMEにPDF Associationのダウンロードリンクを記載

## 10. ポートフォリオとしての位置づけ

`@shuji-bonji` の MCP エコシステム:

| パッケージ        | ドメイン        | データソース                    |
| ----------------- | --------------- | ------------------------------- |
| `rfcxml-mcp`      | IETF 標準仕様   | RFCXML（オンラインフェッチ）    |
| `w3c-mcp`         | Web 標準仕様    | W3C/WHATWG データ（オンライン） |
| `pdf-spec-mcp` 🆕 | ISO PDF 仕様    | ローカルPDF（ユーザー配置）     |
| `epsg-mcp`        | 座標参照系      | EPSG DB（ローカル）             |
| `rxjs-mcp`        | RxJS ランタイム | 実行エンジン内蔵                |
| `xcomet-mcp`      | 翻訳品質評価    | xCOMETモデル（ローカル）        |

**一貫したビジョン**: 技術仕様をAIエージェントからアクセス可能にする

## 11. 開発ロードマップ（案）

### Phase 0: 技術検証 ← **今週末**

- [x] ISO_32000-2-2020 の Tagged PDF 構造を解析
- [x] セクション・テーブル・定義の抽出可能性を確認
- [x] PDF解析ライブラリの選定

### Phase 1: コア機能（MVP）

- [x] `get_structure` — セクション階層取得
- [x] `get_section` — セクション内容取得
- [x] `search_spec` — キーワード検索
- [ ] npm パッケージ公開

### Phase 2: 要件・定義抽出

- [ ] `get_requirements` — 規範的要件抽出
- [ ] `get_definitions` — 用語定義取得
- [ ] `get_tables` — テーブル構造取得

### Phase 3: 横断参照・拡張仕様

- [ ] `compare_versions` — 1.7 ↔ 2.0 差分
- [ ] `get_ts_section` — TS 32001/32002/32003 対応
- [ ] 電子署名関連セクションの強化

_Last updated: 2025-02-06_
_Author: pdf-spec-mcp 企画定義 for @shuji-bonji_
